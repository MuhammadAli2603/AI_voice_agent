;
; Asterisk Dialplan Configuration for AI Voice Agent
; Place this in /etc/asterisk/extensions.conf
;

[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
; Global variables
VOICE_AGENT_PATH=/opt/ai-voice-agent/telephony/asterisk_agi.py
PYTHON_BIN=/opt/ai-voice-agent/venv/bin/python

;==============================================
; INCOMING CALLS - Route to AI Voice Agent
;==============================================

[incoming]
; Main entry point for all incoming calls
; Calls here will be handled by the AI voice agent

exten => _X.,1,NoOp(=== Incoming Call from ${CALLERID(num)} to ${EXTEN} ===)
 same => n,Answer()
 same => n,Wait(1)
 same => n,AGI(${PYTHON_BIN},${VOICE_AGENT_PATH})
 same => n,Hangup()

;==============================================
; COMPANY-SPECIFIC DIDs
;==============================================

[techstore]
; TechStore - Electronics Retailer
; DID: +1-800-555-1234
exten => 18005551234,1,NoOp(=== TechStore Call ===)
 same => n,Set(COMPANY_ID=techstore)
 same => n,Goto(incoming,${EXTEN},1)

[healthplus]
; HealthPlus - Healthcare Services
; DID: +1-800-555-5678
exten => 18005555678,1,NoOp(=== HealthPlus Call ===)
 same => n,Set(COMPANY_ID=healthplus)
 same => n,Goto(incoming,${EXTEN},1)

[edulearn]
; EduLearn - Online Education
; DID: +1-800-555-9999
exten => 18005559999,1,NoOp(=== EduLearn Call ===)
 same => n,Set(COMPANY_ID=edulearn)
 same => n,Goto(incoming,${EXTEN},1)

;==============================================
; TEST EXTENSIONS
;==============================================

[testing]
; Test extension for development
exten => 100,1,NoOp(=== Test Call ===)
 same => n,Answer()
 same => n,Set(COMPANY_ID=techstore)
 same => n,AGI(${PYTHON_BIN},${VOICE_AGENT_PATH})
 same => n,Hangup()

; Echo test
exten => 200,1,NoOp(=== Echo Test ===)
 same => n,Answer()
 same => n,Echo()
 same => n,Hangup()

; Playback test
exten => 300,1,NoOp(=== Playback Test ===)
 same => n,Answer()
 same => n,Playback(welcome)
 same => n,Playback(goodbye)
 same => n,Hangup()

;==============================================
; EMERGENCY & SYSTEM
;==============================================

[emergency]
; Emergency calls bypass AI
exten => 911,1,NoOp(=== Emergency Call ===)
 same => n,Dial(SIP/emergency-gateway/911)
 same => n,Hangup()

[system]
; System status check
exten => *123,1,NoOp(=== System Status ===)
 same => n,Answer()
 same => n,Playback(system-status)
 same => n,Hangup()

;==============================================
; DEFAULT CONTEXT (Fallback)
;==============================================

[default]
; Catch-all for unmatched calls
exten => _X.,1,NoOp(=== Unmatched Call: ${EXTEN} ===)
 same => n,Answer()
 same => n,Playback(invalid)
 same => n,Hangup()

; Invalid extension
exten => i,1,NoOp(=== Invalid Extension ===)
 same => n,Playback(invalid)
 same => n,Hangup()

; Timeout
exten => t,1,NoOp(=== Timeout ===)
 same => n,Playback(timeout)
 same => n,Hangup()
