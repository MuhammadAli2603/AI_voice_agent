;
; Asterisk Dialplan Configuration for AI Voice Agent (ARI Mode)
; This replaces extensions.conf when using ARI instead of AGI
; Place this in /etc/asterisk/extensions.conf
;

[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
; Global variables for ARI mode
ARI_APP_NAME=voice_agent
ARI_URL=http://localhost:8088/ari
ARI_USER=voice_agent
ARI_PASS=voice_agent_secret_2024

;==============================================
; ARI STASIS APPLICATION ROUTING
;==============================================

[incoming-ari]
; Main entry point for ARI-based calls
; Calls enter the Stasis application and are handled by Python ARI client

exten => _X.,1,NoOp(=== ARI Call from ${CALLERID(num)} to ${EXTEN} ===)
 same => n,Set(CHANNEL(language)=en)
 same => n,Stasis(${ARI_APP_NAME},incoming)
 same => n,Hangup()

;==============================================
; COMPANY-SPECIFIC DIDs (ARI Mode)
;==============================================

[techstore-ari]
; TechStore - Electronics Retailer
; DID: +1-800-555-1234
exten => 18005551234,1,NoOp(=== TechStore ARI Call ===)
 same => n,Set(COMPANY_ID=techstore)
 same => n,Stasis(${ARI_APP_NAME},techstore)
 same => n,Hangup()

; Test extension for TechStore
exten => 100,1,NoOp(=== TechStore Test Call ===)
 same => n,Set(COMPANY_ID=techstore)
 same => n,Stasis(${ARI_APP_NAME},techstore)
 same => n,Hangup()

[healthplus-ari]
; HealthPlus - Healthcare Services
; DID: +1-800-555-5678
exten => 18005555678,1,NoOp(=== HealthPlus ARI Call ===)
 same => n,Set(COMPANY_ID=healthplus)
 same => n,Stasis(${ARI_APP_NAME},healthplus)
 same => n,Hangup()

; Test extension for HealthPlus
exten => 101,1,NoOp(=== HealthPlus Test Call ===)
 same => n,Set(COMPANY_ID=healthplus)
 same => n,Stasis(${ARI_APP_NAME},healthplus)
 same => n,Hangup()

[edulearn-ari]
; EduLearn - Online Education
; DID: +1-800-555-9999
exten => 18005559999,1,NoOp(=== EduLearn ARI Call ===)
 same => n,Set(COMPANY_ID=edulearn)
 same => n,Stasis(${ARI_APP_NAME},edulearn)
 same => n,Hangup()

; Test extension for EduLearn
exten => 102,1,NoOp(=== EduLearn Test Call ===)
 same => n,Set(COMPANY_ID=edulearn)
 same => n,Stasis(${ARI_APP_NAME},edulearn)
 same => n,Hangup()

;==============================================
; TEST EXTENSIONS (ARI Mode)
;==============================================

[testing-ari]
; Echo test (non-ARI, for audio testing)
exten => 200,1,NoOp(=== Echo Test ===)
 same => n,Answer()
 same => n,Echo()
 same => n,Hangup()

; Playback test (non-ARI)
exten => 300,1,NoOp(=== Playback Test ===)
 same => n,Answer()
 same => n,Playback(welcome)
 same => n,Playback(goodbye)
 same => n,Hangup()

; ARI connection test
exten => 400,1,NoOp(=== ARI Connection Test ===)
 same => n,Stasis(${ARI_APP_NAME},test)
 same => n,Hangup()

;==============================================
; EMERGENCY & SYSTEM
;==============================================

[emergency]
; Emergency calls bypass AI
exten => 911,1,NoOp(=== Emergency Call ===)
 same => n,Dial(SIP/emergency-gateway/911)
 same => n,Hangup()

[system]
; System status check
exten => *123,1,NoOp(=== System Status ===)
 same => n,Answer()
 same => n,Playback(system-status)
 same => n,Hangup()

;==============================================
; DEFAULT CONTEXT (Fallback)
;==============================================

[default]
; Catch-all for unmatched calls
exten => _X.,1,NoOp(=== Unmatched Call: ${EXTEN} ===)
 same => n,Answer()
 same => n,Playback(invalid)
 same => n,Hangup()

; Invalid extension
exten => i,1,NoOp(=== Invalid Extension ===)
 same => n,Playback(invalid)
 same => n,Hangup()

; Timeout
exten => t,1,NoOp(=== Timeout ===)
 same => n,Playback(timeout)
 same => n,Hangup()

;==============================================
; NOTES
;==============================================
;
; To use this configuration:
; 1. Copy to /etc/asterisk/extensions.conf
; 2. Ensure ari.conf and http.conf are configured
; 3. Start the Python ARI client (telephony/asterisk_ari.py)
; 4. Reload Asterisk dialplan: asterisk -rx "dialplan reload"
;
; The Stasis() application routes calls to the ARI client where
; full-duplex audio streaming and real-time barge-in are handled.
;
